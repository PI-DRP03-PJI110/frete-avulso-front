<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="utf-8" />
    <title>Dashboards • Gestão de viagens</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script>
      window.APP_PATH = "/frete-avulso-front";
      window.API_URL =
        location.hostname === "localhost" || location.hostname === "127.0.0.1"
          ? "http://127.0.0.1:5000"
          : "https://frete-avulso-back.onrender.com";
    </script>
    <script src="../auth.js"></script>
    <script>
      (async () => {
        await window.__AUTH__.requireAuth();
      })();
    </script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="../dark.css" />
    <link rel="stylesheet" href="../public/header.css" />

    <style>
      :root {
        --card-radius: 16px;
        --shadow-1: 0 8px 24px rgba(0, 0, 0, 0.08);
        --shadow-2: 0 16px 40px rgba(0, 0, 0, 0.14);
      }
      [data-bs-theme="dark"] {
        --shadow-1: 0 8px 24px rgba(0, 0, 0, 0.45);
        --shadow-2: 0 16px 40px rgba(0, 0, 0, 0.6);
      }

      main {
        margin-top: var(--app-header-h, 64px);
      }
      .page-wrap {
        padding-block: clamp(16px, 2.5vw, 28px);
        max-width: 1100px;
      }

      .page-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
      }
      .page-title {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        margin: 0;
        font-weight: 600;
        letter-spacing: -0.01em;
      }
      .page-title .title-icon {
        display: inline-grid;
        place-items: center;
        width: 34px;
        height: 34px;
        border-radius: 8px;
        background: color-mix(in srgb, var(--bs-primary), transparent 86%);
        border: 1px solid var(--bs-border-color);
      }
      .page-title .title-icon i {
        font-size: 1.05rem;
        opacity: 0.9;
      }
      .page-subtle {
        color: var(--bs-secondary-color);
        margin-left: 42px;
      }

      .dash-grid {
        display: grid;
        gap: 1rem;
        grid-template-columns: 1fr;
      }
      @media (min-width: 768px) {
        .dash-grid {
          grid-template-columns: 1fr 1fr;
        }
      }
      @media (min-width: 1200px) {
        .dash-grid {
          grid-template-columns: 1fr 1fr 1fr;
        }
      }

      .dash-card {
        background: var(--bs-body-bg);
        border: 1px solid var(--bs-border-color);
        border-radius: var(--card-radius);
        box-shadow: var(--shadow-1);
        overflow: hidden;
        transition: box-shadow 0.2s ease, transform 0.2s ease;
      }
      .dash-card:hover {
        box-shadow: var(--shadow-2);
        transform: translateY(-2px);
      }

      .dash-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
        padding: 0.9rem 1rem;
        border-bottom: 1px dashed var(--bs-border-color);
      }
      .dash-title {
        font-weight: 600;
      }

      .dash-actions .btn {
        --bs-btn-padding-y: 0.25rem;
        --bs-btn-padding-x: 0.6rem;
      }

      .embed-wrap {
        position: relative;
        width: 100%;
        aspect-ratio: 16 / 10;
        background: var(--bs-body-bg);
      }
      .embed-wrap iframe {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        border: 0;
        background: transparent;
      }
      .skeleton {
        position: absolute;
        inset: 0;
        display: grid;
        place-items: center;
        padding: 1rem;
      }
      .skeleton .placeholder {
        height: 1.25rem;
      }

      :focus {
        outline: 2px solid
          color-mix(in srgb, var(--bs-primary), transparent 55%);
        outline-offset: 2px;
      }

      @media print {
        .d-print-none {
          display: none !important;
        }
        .dash-grid {
          grid-template-columns: 1fr !important;
        }
        .dash-card {
          box-shadow: none;
          border-color: #999;
        }
      }
    </style>
  </head>

  <body>
    <a class="visually-hidden-focusable" href="#main">Pular para o conteúdo</a>

    <main
      id="main"
      class="container page-wrap"
      role="main"
      tabindex="-1"
      aria-labelledby="page-title"
    >
      <div class="page-head">
        <h1 id="page-title" class="page-title h4">
          <span class="title-icon" aria-hidden="true"
            ><i class="bi bi-speedometer2"></i
          ></span>
          Dashboards
        </h1>
        <div class="d-print-none">
          <button
            class="btn btn-outline-secondary btn-sm"
            onclick="window.print()"
          >
            Imprimir
          </button>
        </div>
      </div>
      <p class="page-subtle mb-3">
        Visão rápida: desempenho, custos e receita.
      </p>

      <section class="dash-grid">
        <article class="dash-card">
          <div class="dash-header">
            <span class="dash-title">Fretes por período</span>
            <div class="dash-actions d-print-none">
              <button
                class="btn btn-outline-secondary btn-sm"
                aria-label="Tela cheia: Fretes por período"
                onclick="fullscreenIframe('pbiframe1')"
              >
                <i class="bi bi-arrows-fullscreen" aria-hidden="true"></i>
              </button>
            </div>
          </div>
          <div class="embed-wrap">
            <div class="skeleton">
              <div class="w-100">
                <div class="placeholder-glow mb-2">
                  <span class="placeholder col-12"></span>
                </div>
                <div class="placeholder-glow">
                  <span class="placeholder col-8"></span>
                </div>
              </div>
            </div>
            <iframe
              id="pbiframe1"
              src="https://app.powerbi.com/view?r=SEU-REPORT-ID-1"
              title="Fretes por período"
              allowfullscreen
              loading="lazy"
            ></iframe>
          </div>
        </article>

        <article class="dash-card">
          <div class="dash-header">
            <span class="dash-title">Custos vs Receita</span>
            <div class="dash-actions d-print-none">
              <button
                class="btn btn-outline-secondary btn-sm"
                aria-label="Tela cheia: Custos vs Receita"
                onclick="fullscreenIframe('pbiframe2')"
              >
                <i class="bi bi-arrows-fullscreen" aria-hidden="true"></i>
              </button>
            </div>
          </div>
          <div class="embed-wrap">
            <div class="skeleton">
              <div class="w-100">
                <div class="placeholder-glow mb-2">
                  <span class="placeholder col-12"></span>
                </div>
                <div class="placeholder-glow">
                  <span class="placeholder col-8"></span>
                </div>
              </div>
            </div>
            <iframe
              id="pbiframe2"
              src="https://app.powerbi.com/view?r=SEU-REPORT-ID-2"
              title="Custos vs Receita"
              allowfullscreen
              loading="lazy"
            ></iframe>
          </div>
        </article>

        <article class="dash-card">
          <div class="dash-header">
            <span class="dash-title">Top clientes</span>
            <div class="dash-actions d-print-none">
              <button
                class="btn btn-outline-secondary btn-sm"
                aria-label="Tela cheia: Top clientes"
                onclick="fullscreenIframe('pbiframe3')"
              >
                <i class="bi bi-arrows-fullscreen" aria-hidden="true"></i>
              </button>
            </div>
          </div>
          <div class="embed-wrap">
            <div class="skeleton">
              <div class="w-100">
                <div class="placeholder-glow mb-2">
                  <span class="placeholder col-12"></span>
                </div>
                <div class="placeholder-glow">
                  <span class="placeholder col-8"></span>
                </div>
              </div>
            </div>
            <iframe
              id="pbiframe3"
              src="https://app.powerbi.com/view?r=SEU-REPORT-ID-3"
              title="Top clientes"
              allowfullscreen
              loading="lazy"
            ></iframe>
          </div>
        </article>
      </section>
    </main>

    <script>
      (function initTheme() {
        const isDark = sessionStorage.getItem("darktheme") === "true";
        document.body.setAttribute("data-bs-theme", isDark ? "dark" : "light");
      })();

      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".embed-wrap iframe").forEach((iframe) => {
          const sk = iframe.parentElement.querySelector(".skeleton");
          iframe.addEventListener(
            "load",
            () => {
              if (sk) sk.style.display = "none";
            },
            { once: true }
          );
        });
      });

      function fullscreenIframe(id) {
        const el = document.getElementById(id);
        if (!el) return;
        const req =
          el.requestFullscreen ||
          el.webkitRequestFullscreen ||
          el.mozRequestFullScreen ||
          el.msRequestFullscreen;
        if (req) req.call(el);
      }
    </script>

    <script src="../public/header.js" defer></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
